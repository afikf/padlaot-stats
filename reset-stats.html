<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Player Stats - Kadur-regel Padla'ot</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 500px;
            width: 90%;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 2em;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: bold;
        }
        
        .info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            color: #1565c0;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .reset-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: background 0.3s;
        }
        
        .reset-btn:hover {
            background: #c0392b;
        }
        
        .back-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 14px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: background 0.3s;
        }
        
        .back-btn:hover {
            background: #2980b9;
        }
        
        .loading {
            display: none;
            color: #7f8c8d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ ××™×¤×•×¡ ×¡×˜×˜×™×¡×˜×™×§×•×ª ×©×—×§× ×™×</h1>
        
        <div class="info">
            <strong>××” ×”×¤×¢×•×œ×” ×”×–×• ×¢×•×©×”:</strong><br>
            ×××¤×¡×ª ××ª ×›×œ ×”×¡×˜×˜×™×¡×˜×™×§×•×ª ×©×œ ×›×œ ×”×©×—×§× ×™× ×‘××¡×“ ×”× ×ª×•× ×™×<br>
            (×’×•×œ×™×, ×‘×™×©×•×œ×™×, × ×™×¦×—×•× ×•×ª â†’ 0)
        </div>
        
        <div class="warning">
            âš ï¸ ××–×”×¨×”: ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ!<br>
            ×›×œ ×”×¡×˜×˜×™×¡×˜×™×§×•×ª ×™××¤×¡×• ×œ×¦××™×ª×•×ª
        </div>
        
        <div class="loading" id="loading">
            ğŸ”„ ×××¤×¡ ×¡×˜×˜×™×¡×˜×™×§×•×ª...
        </div>
        
        <button class="reset-btn" onclick="runReset()" id="resetBtn">
            ××™×¤×•×¡ ×›×œ ×”×¡×˜×˜×™×¡×˜×™×§×•×ª
        </button>
        
        <br>
        
        <button class="back-btn" onclick="window.location.href='index.html'">
            ×—×–×¨×” ×œ×¢××•×“ ×”×¨××©×™
        </button>
        
        <button class="back-btn" onclick="window.location.href='admin.html'">
            ×—×–×¨×” ×œ×¢××•×“ ×”× ×™×”×•×œ
        </button>
    </div>

    <script type="module">
        import { collection, getDocs, doc, updateDoc, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { db } from "./firebase-config.js";

        async function resetAllPlayerStats() {
            const loading = document.getElementById('loading');
            const resetBtn = document.getElementById('resetBtn');
            
            try {
                loading.style.display = 'block';
                resetBtn.disabled = true;
                resetBtn.textContent = '×××¤×¡...';
                
                console.log('ğŸ”„ Starting to reset all player stats...');
                
                // Get all players from the database
                const playersSnapshot = await getDocs(collection(db, 'players'));
                
                if (playersSnapshot.empty) {
                    alert('âŒ ×œ× × ××¦××• ×©×—×§× ×™× ×‘××¡×“ ×”× ×ª×•× ×™×');
                    return;
                }
                
                console.log(`ğŸ“Š Found ${playersSnapshot.size} players to check`);
                
                // Use batch operations for efficiency
                const batch = writeBatch(db);
                let playersToUpdate = [];
                
                playersSnapshot.forEach((playerDoc) => {
                    const playerData = playerDoc.data();
                    const playerId = playerDoc.id;
                    
                    // Only update players that have stats to reset
                    if (playerData.totalGoals > 0 || playerData.totalAssists > 0 || playerData.totalWins > 0) {
                        playersToUpdate.push({
                            id: playerId,
                            name: playerData.name,
                            currentStats: {
                                goals: playerData.totalGoals || 0,
                                assists: playerData.totalAssists || 0,
                                wins: playerData.totalWins || 0
                            }
                        });
                        
                        const playerRef = doc(db, 'players', playerId);
                        batch.update(playerRef, {
                            totalGoals: 0,
                            totalAssists: 0,
                            totalWins: 0
                        });
                    }
                });
                
                if (playersToUpdate.length === 0) {
                    alert('âœ… ×›×œ ×”×©×—×§× ×™× ×›×‘×¨ ×¢× 0 ×¡×˜×˜×™×¡×˜×™×§×•×ª - ××™×Ÿ ×¦×•×¨×š ×‘×¢×“×›×•×Ÿ');
                    return;
                }
                
                console.log(`ğŸ”„ Resetting stats for ${playersToUpdate.length} players:`);
                playersToUpdate.forEach(player => {
                    console.log(`   - ${player.name}: ${player.currentStats.goals} goals, ${player.currentStats.assists} assists, ${player.currentStats.wins} wins â†’ 0, 0, 0`);
                });
                
                // Ask for final confirmation
                const confirmed = confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××¤×¡ ×¡×˜×˜×™×¡×˜×™×§×•×ª ×¢×‘×•×¨ ${playersToUpdate.length} ×©×—×§× ×™×?\n\n×¤×¢×•×œ×” ×–×• ×ª××¤×¡ ××ª ×›×œ ×”×’×•×œ×™×, ×”×‘×™×©×•×œ×™× ×•×”× ×™×¦×—×•× ×•×ª ×œ-0.\n\n×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ!`);
                
                if (!confirmed) {
                    console.log('âŒ Operation cancelled by user');
                    return;
                }
                
                // Execute the batch update
                await batch.commit();
                
                console.log('âœ… Successfully reset all player stats to 0!');
                console.log(`ğŸ“Š Updated ${playersToUpdate.length} players`);
                
                // Show success message
                alert(`âœ… ××™×¤×•×¡ ×”×¡×˜×˜×™×¡×˜×™×§×•×ª ×”×•×©×œ× ×‘×”×¦×œ×—×”!\n\n${playersToUpdate.length} ×©×—×§× ×™× ×¢×•×“×›× ×•\n×›×œ ×”×’×•×œ×™×, ×”×‘×™×©×•×œ×™× ×•×”× ×™×¦×—×•× ×•×ª ××•×¤×¡×• ×œ-0`);
                
            } catch (error) {
                console.error('âŒ Error resetting player stats:', error);
                alert('×©×’×™××” ×‘××™×¤×•×¡ ×”×¡×˜×˜×™×¡×˜×™×§×•×ª: ' + error.message);
            } finally {
                loading.style.display = 'none';
                resetBtn.disabled = false;
                resetBtn.textContent = '××™×¤×•×¡ ×›×œ ×”×¡×˜×˜×™×¡×˜×™×§×•×ª';
            }
        }

        // Make the function globally available
        window.runReset = resetAllPlayerStats;
    </script>
</body>
</html> 